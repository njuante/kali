#!/bin/sh

#####################################################
#            BSPWM Configuration                    #
#            eriic1002 Style - s4vitar based        #
#####################################################

# ─────────────────────────────────────────────────────
# Monitor y Workspaces (números romanos)
# ─────────────────────────────────────────────────────
bspc monitor -d I II III IV V VI VII VIII IX X

# ─────────────────────────────────────────────────────
# Configuración Global de BSPWM
# ─────────────────────────────────────────────────────
bspc config border_width            0
bspc config window_gap              12
bspc config top_padding             60
bspc config bottom_padding          5
bspc config left_padding            5
bspc config right_padding           5

bspc config split_ratio             0.52
bspc config borderless_monocle      true
bspc config gapless_monocle         true
bspc config single_monocle          true

# IMPORTANTE: Desactivar focus_follows_pointer puede mejorar rendimiento
bspc config focus_follows_pointer   false
bspc config pointer_follows_focus   false
bspc config pointer_follows_monitor false

bspc config remove_disabled_monitors    true
bspc config remove_unplugged_monitors   true

# Reducir carga de eventos
bspc config ignore_ewmh_focus       true

# ─────────────────────────────────────────────────────
# Colores de Bordes
# ─────────────────────────────────────────────────────
bspc config normal_border_color     "#1a1b26"
bspc config active_border_color     "#d81b60"
bspc config focused_border_color    "#d81b60"
bspc config presel_feedback_color   "#9ece6a"

# ─────────────────────────────────────────────────────
# Reglas de Aplicaciones
# ─────────────────────────────────────────────────────
# NO añadir reglas para Polybar - funciona mejor sin ellas

bspc rule -a Firefox desktop='^2' follow=on
bspc rule -a firefox-esr desktop='^2' follow=on
bspc rule -a Thunar desktop='^4' follow=on
bspc rule -a File-roller state=floating
bspc rule -a Lxappearance state=floating
bspc rule -a Pavucontrol state=floating
bspc rule -a feh state=floating
bspc rule -a mpv state=floating

# ─────────────────────────────────────────────────────
# Autostart - OPTIMIZADO
# ─────────────────────────────────────────────────────

# Matar procesos previos de forma segura
killall -q sxhkd 2>/dev/null
killall -q polybar 2>/dev/null
killall -q picom 2>/dev/null
killall -q dunst 2>/dev/null

# Esperar a que terminen
sleep 0.3

# Cursor
xsetroot -cursor_name left_ptr &

# SXHKD - Hotkeys (ESENCIAL)
pgrep -x sxhkd > /dev/null || sxhkd &

# VMware user (para VMs)
vmware-user-suid-wrapper &

# Picom - Compositor
picom --config $HOME/.config/picom/picom.conf &

# Fix Java
wmname LG3D &
export _JAVA_AWT_WM_NONREPARENTING=1

# Polkit
/usr/libexec/polkit-mate-authentication-agent-1 &

# Wallpaper - TU FONDO DE PANTALLA
if [ -f "$HOME/wallpapers/2151158655.jpg" ]; then
    feh --bg-fill "$HOME/wallpapers/2151158655.jpg" &
elif [ -f "$HOME/wallpapers/2151160587.jpg" ]; then
    feh --bg-fill "$HOME/wallpapers/2151160587.jpg" &
fi

# Polybar
~/.config/polybar/launch.sh &
