#!/bin/bash

#####################################################
#            BSPWM Configuration                    #
#            Cyberpunk Theme - 1920x1080            #
#####################################################

# ─────────────────────────────────────────────────────
# Monitor y Workspaces
# ─────────────────────────────────────────────────────
bspc monitor -d I II III IV V VI VII VIII IX X

# ─────────────────────────────────────────────────────
# Configuración Global de BSPWM
# ─────────────────────────────────────────────────────
bspc config border_width            2
bspc config window_gap              12
bspc config top_padding             45
bspc config bottom_padding          5
bspc config left_padding            5
bspc config right_padding           5

bspc config split_ratio             0.52
bspc config borderless_monocle      true
bspc config gapless_monocle         true
bspc config focus_follows_pointer   true
bspc config pointer_follows_focus   false
bspc config pointer_follows_monitor true

bspc config remove_disabled_monitors    true
bspc config remove_unplugged_monitors   true

# ─────────────────────────────────────────────────────
# Colores de Bordes (Tema Cyberpunk)
# ─────────────────────────────────────────────────────
bspc config normal_border_color     "#1a1b26"
bspc config active_border_color     "#bb9af7"
bspc config focused_border_color    "#7aa2f7"
bspc config presel_feedback_color   "#9ece6a"

# ─────────────────────────────────────────────────────
# Reglas de Aplicaciones
# ─────────────────────────────────────────────────────
bspc rule -a Firefox desktop='^2' follow=on
bspc rule -a firefox-esr desktop='^2' follow=on
bspc rule -a Burp\ Suite desktop='^3' follow=on state=tiled
bspc rule -a burp-StartBurp desktop='^3' follow=on
bspc rule -a Thunar desktop='^4' follow=on
bspc rule -a File-roller state=floating
bspc rule -a Lxappearance state=floating
bspc rule -a Pavucontrol state=floating
bspc rule -a Gpick state=floating
bspc rule -a Nm-connection-editor state=floating
bspc rule -a feh state=floating
bspc rule -a mpv state=floating
bspc rule -a Viewnior state=floating
bspc rule -a Zathura state=tiled

# ─────────────────────────────────────────────────────
# Autostart
# ─────────────────────────────────────────────────────

# Matar procesos previos
killall -q sxhkd polybar picom dunst

# Esperar a que terminen
while pgrep -u $UID -x polybar >/dev/null; do sleep 1; done

# Iniciar sxhkd
sxhkd &

# Iniciar compositor
picom --config ~/.config/picom/picom.conf &

# Iniciar polybar
~/.config/polybar/launch.sh &

# Notificaciones
dunst -config ~/.config/dunst/dunstrc &

# Wallpaper
if [ -f ~/wallpapers/2151158655.jpg ]; then
    feh --bg-fill ~/wallpapers/2151158655.jpg
elif [ -f ~/wallpapers/2151160587.jpg ]; then
    feh --bg-fill ~/wallpapers/2151160587.jpg
elif [ -f ~/wallpapers/wallpaper.jpg ]; then
    feh --bg-fill ~/wallpapers/wallpaper.jpg
else
    feh --bg-fill /usr/share/backgrounds/kali-16x9/kali-layers.png 2>/dev/null
fi

# Policy Kit
/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 &

# Cursor
xsetroot -cursor_name left_ptr &

# Configurar resolución (1920x1080)
xrandr --output $(xrandr | grep " connected" | cut -d" " -f1) --mode 1920x1080 --rate 60 2>/dev/null

# Low battery notifier
~/.local/bin/low_battery_notifier.sh &

# ─────────────────────────────────────────────────────
# Fix Java Applications
# ─────────────────────────────────────────────────────
export _JAVA_AWT_WM_NONREPARENTING=1
wmname LG3D &
